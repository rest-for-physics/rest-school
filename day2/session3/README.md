You will need to move to the directory `day2/session2` to match the proposed commands with the relative paths given in the examples.

As you learnt during the corresponding lecture, we can use the REST-for-Physics libraries in different environments, including the `restRoot` ROOT based interactive shell, `C-macros` executed by the ROOT interface interpreter, C++ compiled executables, or `python3` scripts.

In this session we will learn how to access REST-for-Physics generated files using `python3`, although the use of this commands (or lines of code), can be used in a similar way in all the previous environments mentioned.

### Required python headers

When we write our python script we need to import the ROOT libraries, and any REST library we used to generate or process our files. This is done automatically by the `import REST` command inside python.

In order to use REST libraries in python it is enough to import both ROOT and REST libraries using the `import` python command:

```python
#!/usr/bin/python3

import ROOT
import REST
```

During the exercises you may chose to write the commands inside a file and execute the file, or write them directly inside a python3 interactive session.

### Exercise 1. Opening a ROOT file processed with REST

The first main class we need to know in REST is [TRestRun](https://sultan.unizar.es/rest/classTRestRun.html). TRestRun defines few helper methods that centralize the access to the event data, the analysis tree and the metadata objects stored inside the file. `TRestRun` can be used to open a ROOT file generated with REST, and access the data in a coherent way.

The following example shows how to create a `TRestRun` instance , named *rn* in this script, print the run metadata information, and get the number of event entries stored inside the file.

```python
# We open a ROOT file generated by REST
rn = ROOT.TRestRun("../../data/R11567_00001_RawToTrack_Background_21hr_jgalan_2.3.15.root" )

# We print the information of the run metadata object
rn.PrintMetadata()

# We get the number of entries
nEntries =  rn.GetEntries()
print ( "The number of entries is : " + str( nEntries ) )
```

**NOTE:** We will work here with the `RawTrack` files that belong to `fSubRunNumber=00001` since those files were generated using `TRestProcessRunner::fInputEventStorage=True` and `TRestProcessRunner::fOuputEventStorage=True`, therefore they contain all the intermediate event types generated during the data chain.

### Exercise 2. Accessing the stored metadata objects using TRestRun

The following example uses the previous existing *rn* instance to retrieve a list of metadata objects found inside the file, prints the list with the metadata name together with its specific metadata class name, and calls the `PrintMetadata` method (present at any metadata class) to print information regarding one of the metadata objects in the list.

```python
# We recover the metadata object names that the user defined at the RML configuration file
mdNames = rn.GetMetadataNames()

# We iterate over the list and print the name together with the object class name
print("\n")
print ("The following metadata objects are found inside the file")
print ("--------------------------------------------------------")
for md in mdNames:
    print ( md + " is: " + rn.GetMetadata( md ).ClassName() )
print("\n") 

# We print the metadata information from the second element in the list
print ("We print the metadata information of the second element in the list:" )
print ("--------------------------------------------------------------------")
rn.GetMetadata( mdNames[1] ).PrintMetadata() 
```

We may now use any method defined at the recovered metadata instance.

### Exercise 3. Accessing data members from a stored metadata object

We can access the metadata members defined in each class (you may check the corresponding members by exploring the header file or doxygen class documentation](https://sultan.unizar.es/rest/classes.html) (recommended), or by invoking `Dump()` for a given metadata instance. For example, the [TRestRawVetoAnalysisProcess](https://sultan.unizar.es/rest/classTRestRawVetoAnalysisProcess.html), contains a metadata member named `fThreshold`, which was used during the data processing.

We can recover the value using:

```
rn.GetMetadataMember("veto::fThreshold")
```

or

```
rn.GetMetadataMember("TRestRawVetoAnalysisProcess::fThreshold")
```

where the latest command will return the value of the first metadata instance that is of type `TRestRawVetoAnalysisProcess`. In our example there is only one instance, thus any of both ways will produce the same result.

The returned value will always be an string, and conversion to a numeric value might be necessary

```
threshold = int( rn.GetMetadataMember("TRestRawVetoAnalysisProcess::fThreshold") )
```

### Exercise 4. Accessing the analysis tree from TRestRun

Using the instance of TRestRun, `rn`, we can gain access to the analysis tree. The analysis tree contains all the observables added during the processing of the data for each event, and it can be operated as a standard ROOT `TTree` object. Important to read the [ROOT TTree documentation!](https://root.cern.ch/root/htmldoc/guides/users-guide/Trees.html).

For example, we could use the analysis tree to generate a histogram and draw the observable named `sAna_ThresholdIntegral`. In python this can be done as follows:

```
c = ROOT.TCanvas
histo1 = ROOT.TH1F(‘histo1’,‘histo1’ ,1000 ,0 ,500000)
rn.GetAnalysisTree().Project("histo1", "bb" )
histo1.GetEntries()
histo1.Draw()
```

This is similar as when we accessed the `TTree` compiled with a set of files using `TRestDataSet`, but this time we only access the data of a single run, the run which we opened at the beginning of this tutorial.

### Exercise 5. Accessing different event entries inside the event

From the *rn* instance we may also get access to the event data and the analysis tree data in a coherent way. We can get access to those objects using the `TRestRun` methods. When we request an entry or event id to the `TRestRun` instance, the event pointer, named here *tckEv*, and the analysis tree pointer, named here *aT*, will change their memory address to point to the location of the event entry we specified using one of the following `TRestRun` methods: `GetEntry(N)`, `GetNextEntry()` or `GetEventWithID(id)`.

Then, we may get any entry number found inside the file. In this example we print the event data and analysis tree observables from 3 different event entries.

```python
tckEv = rn.GetInputEvent()
aT = rn.GetAnalysisTree()

rn.GetEntry(10)
tckEv.GetID()
tckEv.PrintEvent()
aT.PrintObservables()

# We get the next entry. It should be entry 11.
rn.GetNextEntry()
tckEv.GetID()
tckEv.PrintEvent()
aT.PrintObservables()

# We get the event with id 6960 which we are certain exists inside the file
rn.GetEventWithID(6960)
tckEv.GetID()
tckEv.PrintEvent()
aT.PrintObservables()
```

**NOTE:** The event entry number is just the position of the entry within the file, but it does not serve to fully identify the event between different processing stages with different output files. The event ID in the other hand is unique, and it can be used all along the life of the data processing to identify the origin of the event.

### Exercise 5. Drawing events

In the same way as we print the event data information and the observable values of each event, we may visualize the event invoking the method `DrawEvent` available in any class inheriting from `TRestEvent`.

As we did previously, we need to pre-load the entry we wish to visualize, and have created a `TCanvas` window instance previously.

```
c = ROOT.TCanvas
rn.GetEntry(100)
tckEv.DrawEvent()
```

The `DrawEvent` method might receive an optional argument that allows to control what information we want to visualize from the event data. See for example the [TRestGeant4Event::DrawEvent](https://sultan.unizar.es/rest/classTRestGeant4Event.html#acbfe704537c529ce05fa101719d34b56) or the [TRestRawSignalEvent::DrawEvent](https://sultan.unizar.es/rest/classTRestRawSignalEvent.html#a5445f401b350b1d952670a7323594f6d) documentation.

### Exercise 6. Accessing event types other than the last 
First we need to create an event holder and tell the run instance which type of event we want to read.

**NOTE**: If we have processed the file using `inputEventStorage=True` we will be able to access any event type present in the complete event data processing chain. In the following example we will access different event types stored in the file.

Note that in order to register the event data inside our analysis file it is necesary to enable the parameter `outputEventStorage`. If this parameter is not specified, its default will be normally `on`.

### Iterating over the events inside a REST file

Obviously, once we got an instance of the run `rn` we may iterate over all the events to get specific information and perform a dedicated analysis using the event or analysis tree methods. Each time we call the `TRestRun::GetEntry` method, the `aT` and `g4Ev` objects linked to the run will be updated with the new event and analysis information for that event entry.

```python
for n in range(nEntries):
	rn.GetEntry(n)
	##
	## We do whatever we need with g4Ev and aT for each event entry
	##
	## For example:
	for t in range( g4Ev.GetNumberOfTracks() )
	    print( "Entry: " + str(n) + " track: " + str(t) + " Partice: " + str(g4Ev.GetTrack(t).GetParticleName())
```

To access specific events, check the available methods for each event type. For example, for geant4 event we will be willing to access a [TRestGeant4Event](https://sultan.unizar.es/rest/classTRestGeant4Event.html) and the tracks stored inside, encapsulated inside a [TRestGeant4Track](https://sultan.unizar.es/rest/classTRestGeant4Track.html).

### Exercise X. Retrieving specific observable values

Once we get access to the analysis tree in an iterative way we may recover the value of any of the observables inside the tree and do any calculation we are willing to, create a custom histogram, draw them, print their value, etc.

```python
for n in range(nEntries):
	rn.GetEntry(n)
	
	obsValue = aT.GetDblObservableValue("g4Ana_totalEdep")
	print("g4Ana_totaleEdep: " + str(obsValue) + " keV" )
```

### Exercise X. Getting event entries that satisfy certain conditions

### Exercise X. Quick access to the file information using restRoot
